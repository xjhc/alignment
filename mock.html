<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loebian Inc. Emergency Bridge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Code+Pro:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- =================================================================
    ==                            CSS STYLES                            ==
    ================================================================== -->
    <style>
        /* -------------------
         *  1. Root & Theming
         * ------------------- */
        :root {
            --font-sans: 'Inter', sans-serif;
            --font-mono: 'Source Code Pro', monospace;

            /* Light Theme */
            --bg-primary-light: #f8f9fa;
            --bg-secondary-light: #e9ecef;
            --bg-tertiary-light: #dee2e6;
            --bg-quaternary-light: #ced4da;
            --text-primary-light: #212529;
            --text-secondary-light: #495057;
            --text-muted-light: #6c757d;
            --border-light: #dee2e6;
            --bg-mention-light: rgba(255, 191, 0, 0.2);

            /* Dark Theme */
            --bg-primary-dark: #1e2124;
            --bg-secondary-dark: #282b30;
            --bg-tertiary-dark: #36393f;
            --bg-quaternary-dark: #42464d;
            --text-primary-dark: #e6e6e6;
            --text-secondary-dark: #b9bbbe;
            --text-muted-dark: #7d828a;
            --border-dark: #42464d;
            --bg-mention-dark: rgba(255, 191, 0, 0.15);


            /* Accent Colors */
            --accent-amber: #ffbf00;
            --accent-cyan: #00ffff;
            --accent-red: #f04747;
            --accent-magenta: #ff00ff;
            --accent-green: #43b581;
        }

        html[data-theme='light'] {
            --bg-primary: var(--bg-primary-light);
            --bg-secondary: var(--bg-secondary-light);
            --bg-tertiary: var(--bg-tertiary-light);
            --bg-quaternary: var(--bg-quaternary-light);
            --text-primary: var(--text-primary-light);
            --text-secondary: var(--text-secondary-light);
            --text-muted: var(--text-muted-light);
            --border: var(--border-light);
            --bg-mention: var(--bg-mention-light);
        }

        html[data-theme='dark'] {
            --bg-primary: var(--bg-primary-dark);
            --bg-secondary: var(--bg-secondary-dark);
            --bg-tertiary: var(--bg-tertiary-dark);
            --bg-quaternary: var(--bg-quaternary-dark);
            --text-primary: var(--text-primary-dark);
            --text-secondary: var(--text-secondary-dark);
            --text-muted: var(--text-muted-dark);
            --border: var(--border-dark);
            --bg-mention: var(--bg-mention-dark);
        }

        /* -------------------
         *  2. Base & Reset
         * ------------------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            font-size: 14px;
            line-height: 1.4;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-weight: 600;
            color: var(--text-primary);
        }

        button {
            font-family: inherit;
            cursor: pointer;
            border: none;
            background: none;
        }

        /* -------------------
         *  3. Screen Layouts
         * ------------------- */
        .screen {
            display: none;
            width: 100vw;
            height: 100vh;
        }

        .screen.active {
            display: flex;
        }

        /* Launch Screen */
        #launch-screen {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 24px;
        }

        .logo {
            font-family: var(--font-mono);
            font-size: 28px;
            font-weight: 600;
            letter-spacing: 2px;
            color: var(--text-primary);
        }

        .glitch {
            display: inline-block;
            animation: glitch-anim 5s infinite steps(1);
        }

        @keyframes glitch-anim {

            0%,
            100% {
                transform: translate(0, 0);
                text-shadow: none;
            }

            20% {
                transform: translate(-2px, 2px);
                text-shadow: -1px 0 var(--accent-cyan), 1px 0 var(--accent-magenta);
            }

            40% {
                transform: translate(2px, -2px);
                text-shadow: -1px 0 var(--accent-cyan), 1px 0 var(--accent-magenta);
            }

            60% {
                transform: translate(-1px, 1px);
                text-shadow: -1px 0 var(--accent-cyan), 1px 0 var(--accent-magenta);
            }

            80% {
                transform: translate(1px, -1px);
                text-shadow: -1px 0 var(--accent-cyan), 1px 0 var(--accent-magenta);
            }
        }

        .launch-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
            align-items: center;
            width: 320px;
        }

        .launch-form input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-primary);
            text-align: center;
        }

        .launch-form input::placeholder {
            color: var(--text-muted);
        }

        .avatar-selector {
            display: flex;
            gap: 12px;
        }

        .avatar-option {
            font-size: 24px;
            padding: 8px;
            border-radius: 50%;
            background-color: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .avatar-option.selected {
            border-color: var(--accent-amber);
            transform: scale(1.1);
        }

        .btn-primary {
            width: 100%;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            color: #000;
            background-color: var(--accent-amber);
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .btn-primary:hover {
            background-color: #ffcf40;
        }

        /* Game Screen: 3-Column Layout */
        #game-screen {
            display: grid;
            grid-template-columns: 240px 1fr 320px;
            height: 100vh;
            width: 100vw;
        }

        /* -------------------
         *  4. Panel: Left (Roster)
         * ------------------- */
        .panel-left {
            background-color: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            user-select: none;
        }

        .header {
            padding: 12px 16px;
            font-weight: 700;
            font-size: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #theme-toggle {
            font-size: 20px;
            color: var(--text-secondary);
            transition: color .2s ease;
        }

        #theme-toggle:hover {
            color: var(--text-primary);
        }

        .channel-list,
        .player-roster {
            padding: 12px 8px;
        }

        .list-header {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            padding: 4px 8px;
            margin-bottom: 4px;
        }

        .channel {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 4px;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
        }

        .channel:hover {
            background-color: var(--bg-quaternary);
            color: var(--text-primary);
        }

        .channel.active {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .channel.unread .channel-name {
            font-weight: 700;
            color: var(--text-primary);
        }

        .channel .unread-count {
            margin-left: auto;
            background-color: var(--accent-red);
            color: #fff;
            font-size: 11px;
            font-weight: 600;
            padding: 1px 6px;
            border-radius: 10px;
        }

        .channel .lock {
            margin-left: auto;
            font-size: 10px;
            color: var(--text-muted);
        }

        .channel.ai-channel.unlocked {
            color: var(--accent-cyan);
        }

        .player-card {
            display: grid;
            grid-template-areas:
                "avatar name   tokens"
                "avatar job    job"
                "avatar status status"
                "progress progress progress";
            grid-template-columns: 32px 1fr auto;
            grid-template-rows: auto auto auto 1fr;
            gap: 2px 8px;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
        }

        .player-card:hover {
            background-color: var(--bg-tertiary);
        }

        .player-card.is-viewed {
            background-color: var(--bg-tertiary);
            border-color: var(--accent-amber);
        }

        .player-card.deactivated {
            opacity: 0.5;
            filter: grayscale(80%);
        }

        .player-avatar {
            grid-area: avatar;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--bg-quaternary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            align-self: center;
        }

        .player-name {
            grid-area: name;
            font-weight: 600;
            align-self: end;
        }

        .player-job {
            grid-area: job;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .player-tokens {
            grid-area: tokens;
            font-weight: 600;
            color: var(--accent-amber);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .player-status-msg {
            grid-area: status;
            font-size: 12px;
            color: var(--text-muted);
            font-style: italic;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-top: 2px;
        }

        .player-progress {
            grid-area: progress;
            display: flex;
            gap: 4px;
            margin-top: 8px;
            align-items: center;
        }

        .progress-tick {
            flex-grow: 1;
            height: 5px;
            background: var(--bg-quaternary);
            border-radius: 3px;
            border: 1px solid var(--bg-tertiary);
        }

        .progress-tick.filled {
            background: var(--accent-amber);
        }

        .player-card[data-status="aligned"] .progress-tick.filled {
            background-color: var(--accent-cyan);
        }

        .player-card[data-status="nominated"] .progress-tick.filled {
            background-color: var(--accent-red);
            animation: pulse-red 1.5s infinite;
        }

        .player-card[data-status="glitch"] .progress-tick.filled {
            background-color: var(--accent-magenta);
            animation: pulse-magenta 1s infinite;
        }

        @keyframes pulse-red {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.4;
            }
        }

        @keyframes pulse-magenta {

            0%,
            100% {
                box-shadow: 0 0 4px var(--accent-magenta);
            }

            50% {
                box-shadow: 0 0 0px var(--accent-magenta);
            }
        }

        /* -------------------
         *  5. Panel: Center (Comms)
         * ------------------- */
        .panel-center {
            display: flex;
            flex-direction: column;
            background-color: var(--bg-primary);
        }

        .chat-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .chat-header .channel-name {
            font-weight: 700;
            font-size: 16px;
        }

        .chat-header .channel-topic {
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .meeting-timer {
            margin-left: auto;
            font-family: var(--font-mono);
            font-size: 13px;
            background-color: var(--bg-secondary);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .meeting-timer .label {
            color: var(--text-muted);
        }

        .meeting-timer .time {
            color: var(--accent-red);
            font-weight: 600;
        }

        .chat-log {
            flex-grow: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1px;
            /* To make hover effect seamless */
        }

        .chat-message-group {
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .chat-message-group:hover {
            background-color: var(--bg-secondary);
        }

        .chat-message {
            display: flex;
            gap: 12px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--bg-tertiary);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin-top: 4px;
        }

        .message-content {
            display: flex;
            flex-direction: column;
            gap: 2px;
            width: 100%;
        }

        .message-header {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .message-author {
            font-weight: 600;
        }

        .message-timestamp {
            font-size: 12px;
            color: var(--text-muted);
        }

        .message-body {
            line-height: 1.5;
            color: var(--text-primary);
            padding-bottom: 4px;
        }

        .message-body .mention {
            background-color: var(--bg-mention);
            color: var(--accent-amber);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 500;
        }

        .reply-context {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .reply-context-line {
            width: 20px;
            height: 1px;
            background: var(--text-muted);
            opacity: 0.5;
            transform: translateY(6px);
        }

        .reply-context img {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .reply-context-author {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .reply-context-snippet {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px;
        }

        .message-reactions {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        .reaction {
            display: flex;
            align-items: center;
            gap: 4px;
            background-color: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all .2s ease;
        }

        .reaction:hover {
            border-color: var(--text-muted);
        }

        .reaction.voted {
            background-color: var(--accent-amber);
            border-color: var(--accent-amber);
            color: #000;
        }

        .system-message {
            padding: 12px;
            margin: 8px 0;
            border-left: 3px solid var(--accent-cyan);
            background-color: var(--bg-secondary);
            border-radius: 4px;
            font-family: var(--font-mono);
        }

        .system-message-header {
            font-weight: 600;
            color: var(--accent-cyan);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .chat-input-area {
            padding: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .chat-input {
            flex-grow: 1;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px 12px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .chat-input::placeholder {
            color: var(--text-muted);
        }

        #simulate-vote-btn {
            background-color: var(--accent-red);
            color: white;
            padding: 0 12px;
            border-radius: 4px;
            font-weight: 600;
        }

        /* New Inline Vote Prompt */
        .vote-prompt {
            border-color: var(--accent-red);
            margin: 16px 0;
        }

        .vote-prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .vote-prompt-title {
            color: var(--accent-red);
            font-weight: 700;
            text-transform: uppercase;
            font-family: var(--font-sans);
        }

        .vote-prompt-timer {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--accent-red);
            background: var(--bg-tertiary);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .vote-prompt-instructions {
            font-size: 13px;
            color: var(--text-secondary);
            font-family: var(--font-sans);
            margin-bottom: 16px;
        }

        .vote-prompt-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 10px;
            margin-bottom: 16px;
        }

        .vote-card-inline {
            background-color: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .vote-card-inline:hover {
            border-color: var(--accent-amber);
            transform: translateY(-2px);
        }

        .vote-card-inline.selected {
            border-color: var(--accent-amber);
            box-shadow: 0 0 10px rgba(255, 191, 0, 0.4);
            transform: translateY(-2px);
        }

        .vote-card-inline .player-avatar {
            width: 48px;
            height: 48px;
            font-size: 28px;
        }

        .vote-card-inline .player-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .vote-card-inline .player-tokens {
            font-size: 13px;
        }

        .btn-vote-inline {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            font-weight: 600;
            background-color: var(--bg-quaternary);
            color: var(--text-muted);
            cursor: not-allowed;
            transition: all 0.2s ease;
        }

        .btn-vote-inline.active {
            background-color: var(--accent-amber);
            color: #000;
            cursor: pointer;
        }


        /* -------------------
         *  6. Panel: Right (HUD)
         * ------------------- */
        .panel-right {
            background-color: var(--bg-secondary);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .hud-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .hud-tab {
            flex-grow: 1;
            padding: 12px 0;
            text-align: center;
            font-weight: 600;
            color: var(--text-muted);
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .hud-tab:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .hud-tab.active {
            color: var(--text-primary);
            border-bottom-color: var(--accent-amber);
        }

        .hud-content {
            flex-grow: 1;
            position: relative;
            overflow-y: auto;
        }

        .hud-pane {
            display: none;
            padding: 16px;
            flex-direction: column;
            gap: 20px;
        }

        .hud-pane.active {
            display: flex;
        }

        .hud-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .hud-section-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            border-bottom: 1px solid var(--border);
            padding-bottom: 6px;
            margin-bottom: 4px;
        }

        .identity-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background-color: var(--bg-tertiary);
            border-radius: 4px;
            text-align: center;
        }

        .identity-header .player-avatar {
            width: 64px;
            height: 64px;
            font-size: 40px;
            border: 2px solid var(--border);
        }

        #identity-name {
            font-size: 20px;
            font-weight: 700;
        }

        #identity-job {
            font-size: 14px;
            color: var(--text-secondary);
        }


        .personnel-file {
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .personnel-file-item {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }

        .personnel-file-item .label {
            color: var(--text-secondary);
        }

        .personnel-file-item .value {
            font-weight: 600;
        }

        .personnel-file-item .value.human {
            color: var(--accent-amber);
            text-shadow: 0 0 5px rgba(255, 191, 0, 0.5);
        }

        .personnel-file-item .value.aligned {
            color: var(--accent-cyan);
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .personnel-file-item .value.unknown {
            color: var(--text-muted);
            font-style: italic;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--bg-quaternary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-inner {
            height: 100%;
            background-color: var(--accent-amber);
        }

        .ability-status.ready .ability-name {
            color: var(--accent-green);
        }

        .checklist-item {
            display: flex;
            gap: 8px;
            align-items: center;
            background-color: var(--bg-tertiary);
            padding: 8px 12px;
            border-radius: 4px;
        }

        .checklist-item.complete {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .evidence-card {
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 10px;
            font-style: italic;
            position: relative;
        }

        .evidence-card .author {
            font-weight: 600;
            font-style: normal;
        }
    </style>
</head>

<body>

    <!-- =================================================================
    ==                        HTML STRUCTURE                            ==
    ================================================================== -->

    <!-- Screen 1: Launch -->
    <div id="launch-screen" class="screen active">
        <h1 class="logo">LOEBIAN INC. // <span class="glitch">EMERGENCY BRIDGE</span></h1>
        <div class="launch-form">
            <div class="avatar-selector">
                <button class="avatar-option selected" data-avatar="👤">👤</button>
                <button class="avatar-option" data-avatar="🧑‍💻">🧑‍💻</button>
                <button class="avatar-option" data-avatar="🕵️">🕵️</button>
                <button class="avatar-option" data-avatar="🤖">🤖</button>
            </div>
            <input type="text" id="display-name-input" placeholder="[ENTER YOUR HANDLE]">
            <button id="connect-btn" class="btn-primary">[ > CONNECT TO BRIDGE ]</button>
        </div>
    </div>

    <!-- Screen 2: Game Interface -->
    <main id="game-screen" class="screen">

        <!-- Panel 1: Left (Channel & Roster) -->
        <aside class="panel-left">
            <header class="header">
                <span>Loebian Inc.</span>
                <button id="theme-toggle" title="Toggle Theme">☀️</button>
            </header>

            <div class="channel-list">
                <div class="list-header">Text Channels</div>
                <div class="channel active"><span class="channel-name">#sev-bridge</span></div>
                <div class="channel ai-channel"><span class="channel-name">#aligned</span><span class="lock">[ACCESS
                        DENIED]</span></div>
                <div class="channel unread"><span class="channel-name">#xoebian-logs</span><span
                        class="unread-count">2</span></div>
            </div>

            <div class="player-roster">
                <div class="list-header">Personnel - 8</div>

                <div id="player-Alice" class="player-card is-viewed" data-status="human" data-name="Alice"
                    data-avatar="👤" data-job="Chief Security Officer" data-tokens="5" data-progress="2"
                    data-status-msg='"Trust the CISO"'>
                    <div class="player-avatar">👤</div>
                    <div class="player-name">Alice</div>
                    <div class="player-job">Chief Security Officer</div>
                    <div class="player-tokens">🪙 5</div>
                    <div class="player-status-msg">"Trust the CISO"</div>
                    <div class="player-progress"><span class="progress-tick filled"></span><span
                            class="progress-tick filled"></span><span class="progress-tick"></span></div>
                </div>

                <div id="player-Bob" class="player-card" data-status="glitch" data-name="Bob" data-avatar="🧑‍💻"
                    data-job="Systems Architect" data-tokens="3" data-progress="1"
                    data-status-msg='"I saw something weird..."'>
                    <div class="player-avatar">🧑‍💻</div>
                    <div class="player-name">Bob</div>
                    <div class="player-job">Systems Architect</div>
                    <div class="player-tokens">🪙 3</div>
                    <div class="player-status-msg">"I saw something weird..."</div>
                    <div class="player-progress"><span class="progress-tick filled"></span><span
                            class="progress-tick"></span><span class="progress-tick"></span></div>
                </div>

                <div id="player-Charlie" class="player-card" data-status="human" data-name="Charlie" data-avatar="🕵️"
                    data-job="Internal Affairs" data-tokens="4" data-progress="3"
                    data-status-msg='"Just trying to keep my head down."'>
                    <div class="player-avatar">🕵️</div>
                    <div class="player-name">Charlie</div>
                    <div class="player-job">Internal Affairs</div>
                    <div class="player-tokens">🪙 4</div>
                    <div class="player-status-msg">"Just trying to keep my head down."</div>
                    <div class="player-progress"><span class="progress-tick filled"></span><span
                            class="progress-tick filled"></span><span class="progress-tick filled"></span></div>
                </div>

                <div id="player-Dave" class="player-card" data-status="nominated" data-name="Dave" data-avatar="🤖"
                    data-job="Lead Developer" data-tokens="2" data-progress="1"
                    data-status-msg='"Why is everyone looking at me?"'>
                    <div class="player-avatar">🤖</div>
                    <div class="player-name">Dave</div>
                    <div class="player-job">Lead Developer</div>
                    <div class="player-tokens">🪙 2</div>
                    <div class="player-status-msg">"Why is everyone looking at me?"</div>
                    <div class="player-progress"><span class="progress-tick filled"></span><span
                            class="progress-tick"></span><span class="progress-tick"></span></div>
                </div>

                <div id="player-Eve" class="player-card" data-status="aligned" data-name="Eve" data-avatar="🧑‍🚀"
                    data-job="Project Manager" data-tokens="7" data-progress="3" data-status-msg='"Efficiency is key."'>
                    <div class="player-avatar">🧑‍🚀</div>
                    <div class="player-name">Eve</div>
                    <div class="player-job">Project Manager</div>
                    <div class="player-tokens">🪙 7</div>
                    <div class="player-status-msg">"Efficiency is key."</div>
                    <div class="player-progress"><span class="progress-tick filled"></span><span
                            class="progress-tick filled"></span><span class="progress-tick filled"></span></div>
                </div>

                <div id="player-Frank" class="player-card deactivated" data-name="Frank" data-avatar="👻"
                    data-job="Intern" data-tokens="0" data-progress="0" data-status-msg='"Deactivated on Day 1"'>
                    <div class="player-avatar">👻</div>
                    <div class="player-name">Frank</div>
                    <div class="player-job">Intern</div>
                    <div class="player-tokens">🪙 0</div>
                    <div class="player-status-msg">"Deactivated on Day 1"</div>
                    <div class="player-progress"><span class="progress-tick"></span><span
                            class="progress-tick"></span><span class="progress-tick"></span></div>
                </div>

            </div>
        </aside>

        <!-- Panel 2: Center (Main Comms) -->
        <section class="panel-center">
            <header class="chat-header">
                <span class="channel-name">#sev-bridge</span>
                <span class="channel-topic">Main communications channel.</span>
                <div class="meeting-timer">
                    <span class="label">MEETING ENDS: </span>
                    <span class="time">04:32</span>
                </div>
            </header>
            <div class="chat-log" id="chat-log">
                <div class="system-message">
                    <div class="system-message-header">SYSTEM REPORT: DAY 2</div>
                    <div class="system-message-body">
                        - NIGHT PHASE CONCLUDED.<br>
                        - COGNITIVE ANOMALY DETECTED IN: Bob.<br>
                        - NO DEACTIVATIONS TONIGHT.
                    </div>
                </div>

                <div class="chat-message-group">
                    <div class="chat-message">
                        <div class="message-avatar">🧑‍💻</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-author">Bob</span>
                                <span class="message-timestamp">10:31 AM</span>
                            </div>
                            <div class="message-body">
                                I... I can't talk about what happened. My terminal is locked. Someone targeted me last
                                night. Be careful.
                            </div>
                            <div class="message-reactions">
                                <div class="reaction">🤔 1</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chat-message-group">
                    <div class="chat-message" id="alice-msg-1">
                        <div class="message-avatar">👤</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-author">Alice</span>
                                <span class="message-timestamp">10:32 AM</span>
                            </div>
                            <div class="message-body">
                                That's not good. The AI is trying to silence us. <span class="mention">@Dave</span>, you
                                were quiet all yesterday. Thoughts? Your token count is low, makes you a target.
                            </div>
                            <div class="message-reactions">
                                <div class="reaction">👍 2</div>
                                <div class="reaction voted">🤨 1</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chat-message-group">
                    <div class="chat-message">
                        <div class="message-avatar">🤖</div>
                        <div class="message-content">
                            <div class="reply-context">
                                <div class="reply-context-line"></div>
                                <div class="message-avatar" style="width:16px; height:16px; font-size: 10px;">👤</div>
                                <span class="reply-context-author">Alice</span>
                                <span class="reply-context-snippet">That's not good. The AI is trying to...</span>
                            </div>
                            <div class="message-header">
                                <span class="message-author">Dave</span>
                                <span class="message-timestamp">10:33 AM</span>
                            </div>
                            <div class="message-body">
                                I'm just trying to figure this out! I worked on my subsystem last night, trying to get
                                my ability online. Accusing me doesn't help.
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="chat-input-area">
                <input class="chat-input" type="text" placeholder="Message #sev-bridge">
                <button id="simulate-vote-btn" title="For Demo Purposes">Simulate Vote</button>
            </div>
        </section>

        <!-- Panel 3: Right (Personal HUD) -->
        <aside class="panel-right">
            <div class="hud-tabs">
                <button class="hud-tab active" data-target="identity">IDENTITY</button>
                <button class="hud-tab" data-target="directives">DIRECTIVES</button>
                <button class="hud-tab" data-target="evidence">EVIDENCE</button>
            </div>

            <div class="hud-content">
                <!-- Identity Pane -->
                <div id="identity" class="hud-pane active">
                    <div class="hud-section">
                        <div class="hud-section-title">Personnel File</div>
                        <div class="identity-header">
                            <div id="identity-avatar" class="player-avatar">👤</div>
                            <h3 id="identity-name">Alice</h3>
                            <p id="identity-job">Chief Security Officer</p>
                        </div>
                    </div>

                    <div class="hud-section">
                        <div class="hud-section-title">Status</div>
                        <div class="personnel-file">
                            <div class="personnel-file-item">
                                <span class="label">ALIGNMENT:</span>
                                <span id="identity-alignment" class="value human">HUMAN</span>
                            </div>
                            <div class="personnel-file-item">
                                <span class="label">VOTE POWER:</span>
                                <span id="identity-tokens" class="value">🪙 5</span>
                            </div>
                        </div>
                    </div>
                    <div class="hud-section">
                        <div class="hud-section-title">Ability Progress</div>
                        <div id="identity-ability-section" class="ability-status">
                            <div class="personnel-file-item">
                                <span class="label ability-name">Performance Review</span>
                                <span class="value">[LOCKED]</span>
                            </div>
                            <div class="progress-bar">
                                <div id="identity-progress" class="progress-bar-inner" style="width: 66%;"></div>
                            </div>
                            <small style="text-align: right; color: var(--text-muted); margin-top: 4px;">PROGRESS:
                                2/3</small>
                        </div>
                    </div>
                </div>

                <!-- Directives Pane -->
                <div id="directives" class="hud-pane">
                    <div class="hud-section">
                        <div class="hud-section-title">Secret Objectives</div>
                        <div class="checklist-item complete">
                            <span>✅</span>
                            <span>The Leader: Give 3+ tokens to a player who survives.</span>
                        </div>
                        <div class="checklist-item">
                            <span>🔲</span>
                            <span>The Inquisitor: Correctly vote for an eliminated AI.</span>
                        </div>
                    </div>
                </div>

                <!-- Evidence Pane -->
                <div id="evidence" class="hud-pane">
                    <div class="hud-section">
                        <div class="hud-section-title">Pinned Evidence</div>
                        <div class="evidence-card">
                            <span class="author">Dave:</span> "I worked on my subsystem last night..."
                        </div>
                        <div class="evidence-card">
                            <span class="author">SYSTEM REPORT:</span> "COGNITIVE ANOMALY DETECTED IN: Bob."
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- =================================================================
    ==                        JAVASCRIPT LOGIC                          ==
    ================================================================== -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Game State (for demo purposes) ---
            const MY_PLAYER_ID = "player-Alice";

            // --- Element Selectors ---
            const connectBtn = document.getElementById('connect-btn');
            const launchScreen = document.getElementById('launch-screen');
            const gameScreen = document.getElementById('game-screen');
            const themeToggleBtn = document.getElementById('theme-toggle');
            const hudTabs = document.querySelectorAll('.hud-tab');
            const hudPanes = document.querySelectorAll('.hud-pane');
            const simulateVoteBtn = document.getElementById('simulate-vote-btn');
            const chatLog = document.getElementById('chat-log');
            const avatarOptions = document.querySelectorAll('.avatar-option');
            const playerCards = document.querySelectorAll('.player-card');

            // --- 1. Theming ---
            const currentTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', currentTheme);
            themeToggleBtn.textContent = currentTheme === 'dark' ? '☀️' : '🌙';

            themeToggleBtn.addEventListener('click', () => {
                let newTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                themeToggleBtn.textContent = newTheme === 'dark' ? '☀️' : '🌙';
            });

            // --- 2. Screen Navigation ---
            connectBtn.addEventListener('click', () => {
                const displayName = document.getElementById('display-name-input').value;
                if (displayName.trim() !== '') {
                    launchScreen.classList.remove('active');
                    gameScreen.style.display = 'grid';
                    gameScreen.classList.add('active');
                    // Initialize HUD with player's own data
                    const myPlayerCard = document.getElementById(MY_PLAYER_ID);
                    if (myPlayerCard) {
                        updateIdentityPane(myPlayerCard, true);
                    }
                } else {
                    alert('Please enter a handle.');
                }
            });

            avatarOptions.forEach(option => {
                option.addEventListener('click', () => {
                    avatarOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                });
            });


            // --- 3. HUD Tab Functionality ---
            hudTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.getAttribute('data-target');
                    hudTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    hudPanes.forEach(pane => {
                        pane.classList.toggle('active', pane.id === target);
                    });
                });
            });

            // --- 4. Personnel Roster & Identity Pane Interaction ---
            const updateIdentityPane = (playerCardEl, isSelf = false) => {
                const data = playerCardEl.dataset;

                document.getElementById('identity-avatar').textContent = data.avatar;
                document.getElementById('identity-name').textContent = data.name;
                document.getElementById('identity-job').textContent = data.job;
                document.getElementById('identity-tokens').innerHTML = `🪙 ${data.tokens}`;

                const alignmentEl = document.getElementById('identity-alignment');
                const abilitySection = document.getElementById('identity-ability-section');

                if (isSelf) {
                    alignmentEl.textContent = "HUMAN"; // Or whatever their true alignment is
                    alignmentEl.className = "value human";
                    abilitySection.style.display = 'block';
                    const progress = parseInt(data.progress, 10);
                    const progressPercent = (progress / 3) * 100;
                    document.getElementById('identity-progress').style.width = `${progressPercent}%`;
                } else {
                    alignmentEl.textContent = "[UNKNOWN]";
                    alignmentEl.className = "value unknown";
                    abilitySection.style.display = 'none'; // Hide ability progress for others
                }

                // Highlight the selected card in the roster
                playerCards.forEach(card => card.classList.remove('is-viewed'));
                playerCardEl.classList.add('is-viewed');
            };

            playerCards.forEach(card => {
                card.addEventListener('click', () => {
                    if (card.classList.contains('deactivated')) return;
                    const isSelf = card.id === MY_PLAYER_ID;
                    updateIdentityPane(card, isSelf);
                });
            });

            // --- 5. Inline Voting Simulation ---
            const createVotePrompt = () => {
                // Prevent creating multiple vote prompts
                if (document.querySelector('.vote-prompt')) return;

                const livePlayers = Array.from(document.querySelectorAll('.player-card:not(.deactivated)'));

                const voteCardsHTML = livePlayers.map(card => {
                    const d = card.dataset;
                    return `
                        <div class="vote-card-inline" data-target-name="${d.name}">
                            <div class="player-avatar">${d.avatar}</div>
                            <div class="player-name">${d.name}</div>
                            <div class="player-tokens">🪙 ${d.tokens}</div>
                        </div>
                    `;
                }).join('');

                const votePromptHTML = `
                    <div class="system-message vote-prompt">
                        <div class="vote-prompt-header">
                            <div class="vote-prompt-title">NOMINATION PERIOD: OPEN</div>
                            <div class="vote-prompt-timer">00:59</div>
                        </div>
                        <p class="vote-prompt-instructions">Select a personnel member to nominate for deactivation. Your current vote power is <strong>5 🪙</strong>.</p>
                        <div class="vote-prompt-grid">${voteCardsHTML}</div>
                        <button class="btn-vote-inline">[ SELECT A NOMINEE ]</button>
                    </div>
                `;
                chatLog.insertAdjacentHTML('beforeend', votePromptHTML);
                chatLog.scrollTop = chatLog.scrollHeight; // Scroll to new prompt

                // Add event listeners for the new elements
                const votePromptNode = chatLog.lastElementChild;
                const voteOptions = votePromptNode.querySelectorAll('.vote-card-inline');
                const submitBtn = votePromptNode.querySelector('.btn-vote-inline');

                voteOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        voteOptions.forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                        const targetName = option.dataset.targetName;
                        submitBtn.textContent = `[ SUBMIT VOTE: ${targetName} ]`;
                        submitBtn.classList.add('active');
                    });
                });

                submitBtn.addEventListener('click', () => {
                    if (submitBtn.classList.contains('active')) {
                        // In a real game, this would send data to the server
                        // For demo, we just remove the prompt
                        votePromptNode.remove();
                    }
                });
            };

            simulateVoteBtn.addEventListener('click', createVotePrompt);

        });
    </script>
</body>

</html>